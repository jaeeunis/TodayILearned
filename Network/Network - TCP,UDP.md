# 컴퓨터 네트워크

## Socket programming with UDP and TCP

### TCP / UDP 란 무엇인가 ?

- [x] TCP 신뢰성
- [x] UDP 신속함

> TCP 와 UDP는 OSI 표준모델과 TCP/IP 모델의 **전송계층(Transport Layer)**에서 사용되는 프로토콜이다. 전송계층은 송신자와 수신자를 연결하는 통신 서비스를 제공하고 IP에 의해 전달되는 패킷의 오류를 검사하며 재전송 요구 제어등을 담당한다.
> 즉, 데이터의 전달을 담당한다고 생각하면 된다. 이러한 전송 계층에서 목적에 따라 TCP와 UDP를 구분하여 사용하면 된다.

<br>

### 1. TCP (Transmission Control Protocol) 란?

TCP는 연결 지향적 프로토콜이기 때문에 클라이언트와 서버가 연결된 상태에서 데이터를 주고받는 프로토콜을 의미합니다. 클라이언트가 연결 요청을 하고, 서버가 연결을 수락하면 통신 선로가 고정되고, 모든 데이터는 고정된 통신 선로를 통해서 순차적으로 전달된다. 그렇기 때문에 데이터를 **정확**하고 **안정적**으로 전달할 수 있다.

#### TCP 특징

1.  **신뢰성** : 서버와 클라이언트간에 데이터를 **신뢰성** 있게 전달하기 위해 만들어진 프로토콜이다. TCP의 가장 중요한 특징은 신뢰할 수 있는 장치간 데이터 전달이다. 신뢰성을 제공하기 위해 TCP는 손상 또는 중복되는 네트워크 계층에서 순서가 틀어져서 전달된 데이터를 복구하기 위해 적극적 수신, 통지, 재전송 체계를 사용한다.

2. **흐름 제어** : 데이터 세그먼트를 송수신하는 컴퓨터는 CPU와 네트워크 대역폭의 차이 때문에 서로 다른 데이터 속도로 작동할 수 있다. TCP는 송신자가 보낸 데이터의 양을 제어하는 흐름 제어 메커니즘을 구현한다.

3. **연결형** : TCP를 사용하여 데이터를 보내려면 먼저 연결을 설정해야만 한다. 하나의 전송선로에서 데이터가 양방향으로 전송될 수 있다. 

4. **3-way-handshake 방식** : 클라이언트에서 서버에 연결 요청을 하기 위해 **SYN데이터**를 보낸다. 서버에서 해당 포트는 LISTEN상태에서 SYN데이터를 받으면 SYN_RCV로 상태가 변경된다. 요청이 정상적이라면 서버에서 ACK와 클라이언트 포트도 열어 달라는 SYN데이터를 클라이언트에게 전송한다. 클라이언트에서는 SYN+ACK를 받고 ESTABLISHED로 상태를 변경하고 서버에 ACK를 전송한다. ACK를 받은 서버는 상태가 ESTABLISHED로 변경된다. 

   <img src="https://media.geeksforgeeks.org/wp-content/uploads/CN.png"> 

<br>

#### TCP 구조

<img src="https://kelvin.ink/resources/res/ExplainingTCP_IP/TCP_header.jpeg" width=500px>

1. 송수신자의 포트 번호 (Source port & Destination port) : 가상 회선 양단의 송수신 프로세스에 할당되는 포트 주소
2. 시퀀스 번호 (Sequence number) : byte 단위로 순서화되는 번호이며 이것을 통해 신뢰성 및 흐름제어 기능을 제공한다. 시퀀스의 번호 덕분에 수신자는 쪼개진 세그먼트의 순서를 파악하여 올바른 순서로 데이터를 재조립할 수 있게 된다.
3. Acknowledgment number : 수신하기를 기대하는 다음 byte 번호 (추후에 tcp header 공부를 통해서 내용을 추가!)
4. Header length (Offset) : 헤더 길이 필드
5. Reserved : 차후의 사용을 위해서 예약된 필드이다.
6. TCP Flags : 현재 세그먼트의 속성을 나타내며, 기존에는 6개의 플래그만을 사용했지만 Reserved와 함께 사용한다. 
7. Window : 자신의 수신 버퍼 여유용량 크기를 통보하여 얼마만큼의 데이터를 받을 수 있는지 상대방에게 알려주는 필드
8. Checksum : 송신 도중 발생될 수 있는 비트 오류를 검출하기 위해 체크섬을 사용한다.

### 2. UDP (User Datagram Protocol) 란?

UDP는 전송계층의 비연결 지향적 프로토콜이다. 비연결 지향적이란 데이터를 주고받을 때 연결 절차를 거치지 않고 발신자가 일방적으로 데이터를 발신하는 방식을 의미한다. 연결 과정이 없기 때문에 TCP보다는 빠른 전송을 할 수 있지만 데이터 전달의 신뢰성은 떨어진다. UDP는 발신자가 데이터 패킷을 순차적으로 보내더라도 이 패킷들은 서로 다른 선로를 통해 전달되기 때문에 순서가 온전히 지켜지지 않을 수 있다. 또한 잘못된 선로로 전송된다면 데이터가 유실 될 수도 있다.

#### UDP 특징

1. **신속함** :  정보를 주고 받을 때 정보를 보내거나 받는다는 신호절차를 거치지 않기 때문에 신속하다. 또한 데이터의 재전송과 순서 유지를 위한 작업을 하지 않기 때문에 속도가 TCP에 비해서 빠르다. 그렇기 때문에 실시간 전송이 필요한 부분에 대해서 많이 사용한다.
2. **멀티캐스트 / 브로드캐스트 가능** : TCP는 서로 검증(Point-to-point)이 완료가 되어야 하기 때문에 UDP만 멀티캐스트, 브로드캐스트 할 수 있다.

`멀티캐스트` : 하나의 송신자가 한번의 데이터 전송으로 같은 서브 네트워크 상의 모든  수신자에게 데이터를 전송하는 것이다. <br>
`브로드캐스트` : 하나 이상의 송신자들이 특정한 하나 이상의 수신자들에게 데이터를 전송하는 방식으로 인터넷 화상 회의 등의 응용에서 사용한다.

#### UDP 구조

<img src="https://kelvin.ink/resources/res/ExplainingTCP_IP/UDP_header.jpg">

1. 송수신자의 포트 번호 (Source port & Destination port) : 가상 회선 양단의 송수신 프로세스에 할당되는 포트 주소
2. Checksum : 헤더와 데이터를 모두 포함한 사용자 데이터그램 전체에 대해 오류를 탐지하기 위해 사용한다.

<br>

### 3. TCP / UDP 차이점

TCP는 연결형 서비스이며, 가상회선 방식을 사용하지만 UDP는 비 연결형 서비스이며 데이터그램 방식을 사용한다. 그렇기 때문에 TCP는 전송 순서를 보장하고 수신 여부를 확인하지만, UDP는 데이터 각각을 나눠서 보낼 수 있기 때문에 전송 순서가 보장되지 않고 수신 여부도 확인하지 않는다. 이러한 점에서 TCP는 1:1 통신만 가능하고, UDP는 1:1, 1:N, N:N 통신 모두 가능하다.
둘의 가장 큰 차이점은 **신뢰성**이기 때문에 데이터의 신뢰성과 정확성이 필요하다면 TCP를 신뢰성이나 정확성보다 속도가 중요하면 UDP를 선택하면 된다.

<hr>

#### 참고

https://gyoogle.dev/blog/computer-science/network/TCP%203%20way%20handshake%20&%204%20way%20handshake.html
https://coding-factory.tistory.com/614